<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>學生資料管理系統</title>
    <link rel="shortcut icon" href="#" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <script src="api/jquery-3.5.1.min.js"></script>
    <!---匯入要使用的函式庫--->


</head>
<body>
  <h1 class="header">學生資料管理系統</h1>
  <!--亂玩的 <button><input type="text" value="">新增</button><br> -->
  <hr>
  <button onclick="openInsert()">新增</button>

  <div class="query">
    <select name="classes" id="classes" onchange="getStudents(this.value)">
    </select><input type="text" name='q'><input type="button" value="查詢" onclick="query()">
    <div class="query-result"></div>
    <div class="students"></div>
  </div>



<div id="insertBlock" style="display:none;">
  <h3>新增學生資料</h3>
  <form action="api/insert.php" method="post" id="create">
    <ul>
      <li>姓名：<input type="text" name="name" id="name"></li>
      <li>學號：<input type="text" name="uni_id" id="uni_id"></li>
      <li>班級座號：<input type="text" name="class_num" id="class_num"></li>
      <li>出生年月日：<input type="text" name="birthday" id="birthday"></li>
      <li>身分證字號：<input type="text" name="nat_id" id="nat_id"></li>
      <li>住址：<input type="text" name="addr" id="addr"></li>
      <li>父母：<input type="text" name="parent" id="parent"></li>
      <li>電話：<input type="text" name="tel" id="tel"></li>
      <li>科別：<input type="text" name="dept" id="dept"></li>
      <li>畢業國中：<input type="text" name="grad_at" id="grad_at"></li>
    </ul>
    <div><input type="button" value="確定新增" onclick="create()"></div>
  </form>
</div>
  
</body>
</html>
<script>
/************************************
* 1.考慮觸發行為的事件
* 2.建立監聽行為
* 3.考慮是否需要代入參數
* 4.是否會有回傳值？回傳值的功用及處理？
* 5.是否需要更新畫面內容？更新畫面的方法？
************************************/


//新增資料的函式
// function create(){
// $.ajax({
//   url:'',
//   type:'',
//   success:function(){

//   }
// })
function create(){
    let name=document.querySelector("#name").value;
    let uni_id=document.querySelector("#uni_id").value;
    let class_num=document.querySelector("#class_num").value;
    let birthday=document.querySelector("#birthday").value;
    let nat_id=document.querySelector("#nat_id").value;
    let addr=document.querySelector("#addr").value;
    let parent=document.querySelector("#parent").value;
    let tel=document.querySelector("#tel").value;
    let dept=document.querySelector("#dept").value;
    let grad_at=document.querySelector("#grad_at").value;
    
    console.log( name, uni_id, class_num, birthday, nat_id, addr, parent, tel, dept, grad_at );
    
    $.post("api/insert.php",{name, uni_id, class_num, birthday, nat_id, addr, parent, tel, dept, grad_at},function(res){
      console.log(res);
      if(res=='1'){
        alert("新增成功");
        document.querySelector("#insertBlock").style.display='none';
      }
    })
}

function openInsert(){
  document.querySelector("#insertBlock").style.display='block';
}

//查詢資料的函式
function getClasses(){
  $.get("api/select_class.php",function(opt){
    // console.log(opt);
    document.querySelector("#classes").innerHTML=opt;
  })
}

// 取class會跟系統出衝突，所以加個_
function getStudents(_class){   
  console.log(_class)
  $.get("api/get_students.php",{'class':_class},function(students){
    console.log(students);
    document.querySelector(".students").innerHTML=students;
  })
}

function query(){
  let str=document.querySelector("#query").value;
  $.get("api/query.php",{str},function(res){
    document.querySelector(".query-result").innerHTML=res;

  })
}


//編輯資料的函式
function update(){

}

//刪除資料的函式
function del(){

}

</script>